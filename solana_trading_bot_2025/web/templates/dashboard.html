<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Trading Bot 2025 Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .status-card {
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        .status-card:hover {
            transform: translateY(-2px);
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .profit-positive { color: #28a745; }
        .profit-negative { color: #dc3545; }
        .status-running { color: #28a745; }
        .status-stopped { color: #dc3545; }
        .status-warning { color: #ffc107; }
        .chart-container {
            height: 300px;
            margin: 20px 0;
        }
        .real-time-updates {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        .update-item {
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }
        .update-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-robot"></i> Solana Trading Bot 2025
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">
                    <i class="fas fa-circle text-success" id="connection-status"></i>
                    <span id="connection-text">Connected</span>
                </span>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Bot Status Cards -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card status-card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-crosshairs"></i> Sniper Bot
                        </h5>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="status-running" id="sniper-status">Running</span>
                            <button class="btn btn-sm btn-outline-primary" onclick="toggleBot('sniper')">
                                <i class="fas fa-power-off"></i>
                            </button>
                        </div>
                        <div class="row mt-3">
                            <div class="col-6">
                                <small class="text-muted">Tokens Scanned</small>
                                <div class="h5" id="sniper-tokens-scanned">0</div>
                            </div>
                            <div class="col-6">
                                <small class="text-muted">Signals Generated</small>
                                <div class="h5" id="sniper-signals">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card status-card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-copy"></i> Copy Bot
                        </h5>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="status-running" id="copy-status">Running</span>
                            <button class="btn btn-sm btn-outline-primary" onclick="toggleBot('copy')">
                                <i class="fas fa-power-off"></i>
                            </button>
                        </div>
                        <div class="row mt-3">
                            <div class="col-6">
                                <small class="text-muted">Tracked Traders</small>
                                <div class="h5" id="copy-traders">0</div>
                            </div>
                            <div class="col-6">
                                <small class="text-muted">Copied Trades</small>
                                <div class="h5" id="copy-trades">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6>Total Profit</h6>
                            <h3 class="profit-positive" id="total-profit">$0.00</h3>
                        </div>
                        <i class="fas fa-dollar-sign fa-2x"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6>Daily P&L</h6>
                            <h3 class="profit-positive" id="daily-pnl">$0.00</h3>
                        </div>
                        <i class="fas fa-chart-line fa-2x"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6>Win Rate</h6>
                            <h3 id="win-rate">0%</h3>
                        </div>
                        <i class="fas fa-trophy fa-2x"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6>Total Trades</h6>
                            <h3 id="total-trades">0</h3>
                        </div>
                        <i class="fas fa-exchange-alt fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts and Data -->
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-area"></i> Performance Chart</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-clock"></i> Recent Activity</h5>
                    </div>
                    <div class="card-body">
                        <div class="real-time-updates" id="recent-activity">
                            <div class="update-item">
                                <small class="text-muted">No recent activity</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Trades Table -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-list"></i> Recent Trades</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Token</th>
                                        <th>Action</th>
                                        <th>Price</th>
                                        <th>Quantity</th>
                                        <th>P&L</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="trades-table">
                                    <tr>
                                        <td colspan="7" class="text-center text-muted">No trades yet</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // WebSocket connection
        let ws = null;
        let chart = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeWebSocket();
            initializeChart();
            loadInitialData();
        });

        function initializeWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/ws`;
            
            ws = new WebSocket(wsUrl);
            
            ws.onopen = function() {
                document.getElementById('connection-status').className = 'fas fa-circle text-success';
                document.getElementById('connection-text').textContent = 'Connected';
            };
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                updateDashboard(data);
            };
            
            ws.onclose = function() {
                document.getElementById('connection-status').className = 'fas fa-circle text-danger';
                document.getElementById('connection-text').textContent = 'Disconnected';
                // Reconnect after 5 seconds
                setTimeout(initializeWebSocket, 5000);
            };
        }

        function initializeChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Portfolio Value',
                        data: [],
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        async function loadInitialData() {
            try {
                const [status, performance, trades] = await Promise.all([
                    fetch('/api/status').then(r => r.json()),
                    fetch('/api/performance').then(r => r.json()),
                    fetch('/api/recent_trades').then(r => r.json())
                ]);
                
                updateDashboard(status);
                updatePerformance(performance);
                updateTradesTable(trades);
            } catch (error) {
                console.error('Error loading initial data:', error);
            }
        }

        function updateDashboard(data) {
            // Update sniper bot status
            if (data.bots && data.bots.sniper) {
                const sniper = data.bots.sniper;
                document.getElementById('sniper-status').textContent = sniper.is_running ? 'Running' : 'Stopped';
                document.getElementById('sniper-status').className = sniper.is_running ? 'status-running' : 'status-stopped';
                document.getElementById('sniper-tokens-scanned').textContent = sniper.stats.tokens_scanned || 0;
                document.getElementById('sniper-signals').textContent = sniper.stats.signals_generated || 0;
            }
            
            // Update copy bot status
            if (data.bots && data.bots.copy) {
                const copy = data.bots.copy;
                document.getElementById('copy-status').textContent = copy.is_running ? 'Running' : 'Stopped';
                document.getElementById('copy-status').className = copy.is_running ? 'status-running' : 'status-stopped';
                document.getElementById('copy-traders').textContent = copy.stats.tracked_traders || 0;
                document.getElementById('copy-trades').textContent = copy.stats.copied_trades || 0;
            }
        }

        function updatePerformance(data) {
            document.getElementById('total-profit').textContent = `$${data.total_profit.toFixed(2)}`;
            document.getElementById('daily-pnl').textContent = `$${data.daily_pnl.toFixed(2)}`;
            document.getElementById('win-rate').textContent = `${(data.win_rate * 100).toFixed(1)}%`;
            document.getElementById('total-trades').textContent = data.total_trades;
            
            // Update profit colors
            document.getElementById('total-profit').className = data.total_profit >= 0 ? 'profit-positive' : 'profit-negative';
            document.getElementById('daily-pnl').className = data.daily_pnl >= 0 ? 'profit-positive' : 'profit-negative';
        }

        function updateTradesTable(trades) {
            const tbody = document.getElementById('trades-table');
            
            if (trades.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No trades yet</td></tr>';
                return;
            }
            
            tbody.innerHTML = trades.map(trade => `
                <tr>
                    <td>${new Date(trade.timestamp).toLocaleString()}</td>
                    <td>${trade.token_symbol || 'Unknown'}</td>
                    <td><span class="badge bg-${trade.action === 'buy' ? 'success' : 'danger'}">${trade.action.toUpperCase()}</span></td>
                    <td>$${trade.price.toFixed(6)}</td>
                    <td>${trade.quantity.toFixed(6)}</td>
                    <td class="${trade.pnl >= 0 ? 'profit-positive' : 'profit-negative'}">$${trade.pnl.toFixed(2)}</td>
                    <td><span class="badge bg-${trade.status === 'completed' ? 'success' : 'warning'}">${trade.status}</span></td>
                </tr>
            `).join('');
        }

        function addActivityUpdate(message) {
            const container = document.getElementById('recent-activity');
            const updateItem = document.createElement('div');
            updateItem.className = 'update-item';
            updateItem.innerHTML = `
                <small class="text-muted">${new Date().toLocaleTimeString()}</small><br>
                <span>${message}</span>
            `;
            
            container.insertBefore(updateItem, container.firstChild);
            
            // Keep only last 10 updates
            while (container.children.length > 10) {
                container.removeChild(container.lastChild);
            }
        }

        function toggleBot(botType) {
            // This would send a command to start/stop the bot
            addActivityUpdate(`${botType.charAt(0).toUpperCase() + botType.slice(1)} bot toggled`);
        }

        // Periodic data refresh
        setInterval(loadInitialData, 30000); // Refresh every 30 seconds
    </script>
</body>
</html> 